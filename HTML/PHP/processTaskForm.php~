<?php
session_start();
include '../../../dbconnect.php';
ini_set("display_errors", true);
error_reporting(E_ALL);	
	$tTitle = $sql = $time = "";
	$titleErr = "";
	$hasErrors = false;
	$gid = $_SESSION["gid"];

	if($_SERVER['REQUEST_METHOD']=='POST'){
		$tTitle = cleanData($_POST['task']);
			$titleErr = validate($tTitle, 'tTitle');
			if(!empty($titleErr)){
				$hasErrors = true;
			}//if
		$time = $_POST['taskDate'];
		if(!$hasErrors){
			sendData($tTitle, $username, $time);
			//redirect("../taskSettings.php");			
		}
		else{
			echo $titleErr." ";
			//redirect("../taskSettings.php");			
		}
	}//if

	//FUNCTIONS
	function cleanData($data){
		$data = trim($data);
		$data = stripslashes($data);
		$data = htmlspecialchars($data);
		return $data;
	}//cleanData

	function validate($data, $field) {
			$data = strtolower($data);
			$data = ucfirst($data);
			$sql = "SELECT * FROM task WHERE name = '$data' AND GID = '$gid'";
			$result = mysqli_query($db, $sql);

			$count = mysqli_num_rows($result);
			if($count != 0){
				return "Task of the same name already exists";
			}
			else {
				return "";
			}
	}//function validate

	function sendData($task, $gid, $time){
			$sql = "INSERT INTO task (name, GID, time) VALUES ('$task','$gid', '$time' )";
			$result = mysqli_query($db, $sql);

			if(!$result){
				die('Error: ' . mysqli_error($db));
			}
			else{
				echo "Task successfully created and assigned!";
			}//ifelse
	}//function sendData
?>
